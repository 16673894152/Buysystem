<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lzr.dao.UserMapping">
    <!-- resultMap映射 -->
    <resultMap id="UserMap" type="User">
        <id column="userid" property="userid"/>
        <result column="zhucetime" property="zhucetime"/>
        <result column="username" property="username"/>
        <result column="userpass" property="userpass"/>
        <result column="usernumber" property="usernumber"/>
        <result column="usercard" property="usercard"/>
        <result column="userimg" property="userimg"/>
        <result column="isdelete" property="isdelete"/>
        <result column="name" property="name"/>
        <result column="sex" property="sex"/>
        <result column="usertype" property="usertype"/>
        <result column="shaddress" property="shaddress"/>
        <result column="shzhucetime" property="shzhucetime"/>
        <result column="shstatehuifu" property="shstatehuifu"/>
        <result column="shstate" property="shstate"/>
        <result column="shmoney" property="shmoney"/>
        <association property="hyid" column="hyid"
                     select="com.lzr.dao.HuiyuanMapping.queryById" javaType="Huiyuan" fetchType="lazy"/>

        <collection property="userorderss" javaType="list" ofType="com.lzr.vo.Orders"
                    column="userid" select="com.lzr.dao.OrdersMapping.queryByuserid" fetchType="lazy"/>

        <collection property="shhuorderss" javaType="list" ofType="com.lzr.vo.Orders"
                    column="userid" select="com.lzr.dao.OrdersMapping.queryByshid" fetchType="lazy"/>
        <collection property="shopgouwus" javaType="list" ofType="com.lzr.vo.Shopgouwu"
                    column="userid" select="com.lzr.dao.ShopgouwuMapping.queryByuserid" fetchType="lazy"/>

        <collection property="shoppingjias" javaType="list" ofType="com.lzr.vo.Shoppingjia"
                    column="userid" select="com.lzr.dao.ShoppingjiaMapping.queryByuserid" fetchType="lazy"/>
    </resultMap>

    <!-- 查询所有方法 -->
    <select id="queryAll" resultMap="UserMap">
       select * from user

    </select>

    <!-- 根据主键id查询数据方法 -->
    <select id="queryById" parameterType="int" resultMap="UserMap">
       select * from user where userid = #{userid};
    </select>

    <!-- 根据User条件查询数据方法 -->
    <select id="query" resultMap="UserMap">
        select * from user
        <where>
            <if test="userid != null"> and userid = #{userid}</if>
            <if test="zhucetime != null"> and zhucetime = #{zhucetime}</if>
            <if test="username != null"> and username = #{username}</if>
            <if test="userpass != null"> and userpass = #{userpass}</if>
            <if test="usernumber != null"> and usernumber = #{usernumber}</if>
            <if test="usercard != null"> and usercard = #{usercard}</if>
            <if test="userimg != null"> and userimg = #{userimg}</if>
            <if test="hyid != null">
                 <if test="hyid.hyid != null"> and hyid = #{hyid.hyid}</if>
            </if>
            <if test="isdelete != null"> and isdelete = #{isdelete}</if>
            <if test="sex != null"> and sex = #{sex}</if>
            <if test="usertype != null"> and usertype = #{usertype}</if>
            <if test="shaddress != null"> and shaddress = #{shaddress}</if>
            <if test="shzhucetime != null"> and shzhucetime #{shzhucetime}</if>
            <if test="shstate != null"> and shstate = #{shstate}</if>
        </where>
    </select>

    <!-- 根据User条件模糊查询数据方法 -->
    <select id="queryLike" resultMap="UserMap">
        select *  from user
        <where>
            <if test="userid != null"> and userid like concat('%',#{userid},'%')</if>
            <if test="zhucetime != null"> and zhucetime like concat('%',#{zhucetime},'%')</if>
            <if test="username != null"> and username like concat('%',#{username != null},'%')</if>
            <if test="userpass != null"> and userpass like concat('%',#{userpass},'%')</if>
            <if test="usernumber != null"> and usernumber like concat('%',#{usernumber},'%')</if>
            <if test="usercard != null"> and usercard like concat('%',#{usercard},'%')</if>
            <if test="userimg != null"> and userimg like concat('%',#{userimg},'%')</if>
            <if test="hyid != null">
                <if test="hyid.hyid != null"> and hyid like concat('%',#{hyid.hyid},'%')</if>
            </if>
            <if test="isdelete != null"> and isdelete like concat('%',#{isdelete},'%')</if>
            <if test="sex != null"> and sex = #{sex}</if>
            <if test="usertype != null"> and usertype like concat('%',#{usertype},'%')</if>
            <if test="shaddress != null"> and shaddress like concat('%',#{shaddress},'%')</if>
            <if test="shzhucetime != null"> and shzhucetime like concat('%',#{shzhucetime},'%')</if>
            <if test="shstate != null"> and shstate like concat('%',#{shstate},'%')</if>
        </where>
    </select>

    <!-- 根据User插入数据方法 -->
    <insert id="insert" parameterType="User" useGeneratedKeys="false" keyColumn="userid" keyProperty="userid">
        insert into user
         (zhucetime,username,sex,userpass,usernumber,usercard,userimg,hyid,
         usertype,shaddress,shmoney,shstate,shstatehuifu,isdelete,shzhucetime,name)
        values (now(),#{username},1,#{userpass},null,null,
        null,1,1,null,0,1,null,1,null,null);
    </insert>

    <!-- 根据User条件修改单条数据方法,从传入对象获取主键id -->
    <update id="updateById" parameterType="User">
        update user 
        <set>
            <if test="userid != null"> and userid = #{userid}</if>
            <if test="zhucetime != null"> and zhucetime = #{zhucetime}</if>
            <if test="username != null"> and username = #{username}</if>
            <if test="userpass != null"> and userpass = #{userpass}</if>
            <if test="usernumber != null"> and usernumber = #{usernumber}</if>
            <if test="usercard != null"> and usercard = #{usercard}</if>
            <if test="userimg != null"> and userimg = #{userimg}</if>
            <if test="hyid != null">
                <if test="hyid.hyid != null"> and hyid = #{hyid.hyid}</if>
            </if>
            <if test="isdelete != null"> and isdelete = #{isdelete}</if>
            <if test="sex != null"> and sex = #{sex}</if>
            <if test="usertype != null"> and usertype = #{usertype}</if>
            <if test="shaddress != null"> and shaddress = #{shaddress}</if>
            <if test="shzhucetime != null"> and shzhucetime =#{shzhucetime}</if>
            <if test="shstate != null"> and shstate = #{shstate}</if>
            <if test="shmoney != null"> and shmoney = #{shmoney}</if>
        </set>
        where userid = #{userid}
    </update>

    <delete id="deleteById" parameterType="int">
        delete from user where userid=#{userid}
    </delete>
</mapper>